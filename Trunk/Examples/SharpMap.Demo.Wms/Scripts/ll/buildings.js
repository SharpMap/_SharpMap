var Buildings=function(p){function U(a){g=p.document.createElement("canvas");g.style.webkitTransform="translate3d(0,0,0)";g.style.position="absolute";g.style.pointerEvents="none";g.style.left=0;g.style.top=0;a.appendChild(g);d=g.getContext("2d");d.lineWidth=1;d.lineCap="round";try{d.mozImageSmoothingEnabled=!1}catch(b){}}function h(a,b){var c={},a=a/B,b=b/B;c[i]=0>=b?90:1<=b?-90:V*(2*W(X(C*(1-2*b)))-Y);c[q]=360*(1===a?1:(a%1+1)%1)-180;return c}function Z(a,b){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,d){return b[d]||""})}function $(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4!==c.readyState||!c.status||200>c.status||299<c.status||c.responseText&&b(JSON.parse(c.responseText))};c.open("GET",a);c.send(null)}function K(a){r=a.width;height=a.height;halfWidth=~~(r/2);halfHeight=~~(height/2);D=halfWidth;E=height;g.width=r;g.height=height}function L(a){s=a.x;centerY=a.y}function M(a){t=a.zoom;B=aa<<t;w=1-0.3*(t-x)/(N-x)}function ba(){isZooming=!0;u()}function j(){if(!(t<
x)){var a=h(s-r,centerY-height),b=h(s+r,centerY+height);$(Z(O,{w:a[q],n:a[i],e:b[q],s:b[i],z:t}),ca)}}function ca(a){a&&a.meta.z==t&&(n=a.meta,y=a.data,u())}function u(){d.clearRect(0,0,r,height);if(!(t<x||isZooming)){var a=F(P,w*z),b=F(Q,w*z),c=F(R,w*z);d.strokeStyle=c;var g,e,A,i,k,f,o,q=s-halfWidth-n.x,u=centerY-halfHeight-n.y,l,m,h,j,v,p;G={};H={};c=0;for(g=y.length;c<g;c++){m=!1;i=da(y[c][0]*z,ea);k=y[c][1];l=new Int32Array(k.length);e=0;for(A=k.length-1;e<A;e+=2)l[e]=f=k[e]-q,l[e+1]=o=k[e+1]-
u,!m&&(m=0<f&&f<r&&0<o&&o<height);if(m){d.fillStyle=a;k=new Int32Array(l.length-2);f=[];e=0;for(A=l.length-1-2;e<A;e+=2)o=l[e],m=l[e+1],h=l[e+2],j=l[e+3],v=S(o,m,i),p=S(h,j,i),(h-o)*(v.y-m)>(v.x-o)*(j-m)?(f.length||(f.unshift(m),f.unshift(o),f.push(v.x),f.push(v.y)),f.unshift(j),f.unshift(h),f.push(p.x),f.push(p.y)):(I(f),f=[]),k[e]=v.x,k[e+1]=v.y;I(f);d.fillStyle=b;I(k,T)}}}}function I(a,b){d.beginPath();d.moveTo(a[0],a[1]);for(var c=2,g=a.length;c<g;c+=2)d.lineTo(a[c],a[c+1]);d.closePath();b&&d.stroke();
d.fill()}function S(a,b,c){var d=a+","+c,e=b+","+c,c=J/(J-c);return{x:G[d]||(G[d]=~~((a-D)*c+D)),y:H[e]||(H[e]=~~((b-E)*c+E))}}function F(a,b){var c=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);return"rgba("+[c[1],c[2],c[3],c[4]?b*c[5]:b].join()+")"}p.Int32Array=p.Int32Array||Array;var X=Math.exp,W=Math.atan,da=Math.min,C=Math.PI,Y=C/2,V=180/C,i="latitude",q="longitude",r=height=halfWidth=halfHeight=0,s=centerY=0,t,B,g,d,O,T,P,Q,R,n,y,w=1,z=1,G={},H={},aa=256,x=14,N,D=halfWidth,E=height,J=400,
ea=J-50;isZooming=!1;return{setMap:function(a,b){U(document.querySelector(".leaflet-control-container"));N=17;K({width:b._size.x,height:b._size.y});var c=b._size.divideBy(2);L(b._getTopLeftPoint().add(c));M({zoom:b._zoom});var d;window.addEventListener("resize",function(){d=setTimeout(function(){clearTimeout(d);K({width:b._size.x,height:b._size.y});u();j()},100)},!1);b.on("move",function(){var a=b._size.divideBy(2),a=b._getTopLeftPoint().add(a);L(a);s=a.x;centerY=a.y;u()});b.on("moveend",function(){var a=
b._size.divideBy(2);b._getTopLeftPoint().add(a);var a=h(s-halfWidth,centerY-halfHeight),c=h(s+halfWidth,centerY+halfHeight);n&&(a[i]>n.n||a[q]<n.w||c[i]<n.s||c[q]>n.e)&&j()});b.on("zoomstart",ba);b.on("zoomend",function(){var a={zoom:b._zoom};isZooming=!1;M(a);j()})},render:u,load:function(a,b){O=a;T=!!b.strokeRoofs;P=b.wallColor||"rgb(200,190,180)";Q=b.roofColor||"rgb(250,240,230)";R=b.strokeColor||"rgb(145,140,135)";j()}}}(this);
